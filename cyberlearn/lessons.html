<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberLearn | Lessons Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-image: url('assets/images/8a64a84ca204cd4bc4f075371baa76192838cc82.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #f8fafc;
        }
        .lesson-card { border-radius: 28px; border: 1px solid rgb(226 232 240); padding: 1.5rem; background: white; box-shadow: 0 20px 65px rgba(15, 23, 42, 0.04); transition: border-color 0.2s, box-shadow 0.2s; }
        .lesson-card:hover { border-color: rgb(15 23 42); box-shadow: 0 25px 70px rgba(15, 23, 42, 0.08); }
        .drawer-enter { animation: drawer-enter 0.25s ease-out forwards; }
        @keyframes drawer-enter { from { transform: translateX(-12px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
    
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
<header class="bg-white/30 backdrop-blur-md border-b border-slate-200/70">
    <div class="px-8 lg:px-12 py-4 flex items-center justify-between gap-6">
        <button type="button" id="lessons-header-menu" class="text-3xl text-white hover:opacity-70 transition">
            &#9776;
        </button>
        <nav class="hidden md:flex items-center gap-6 text-sm font-semibold text-slate-900">
            <a href="dashboard.html" class="hover:text-slate-900">Dashboard</a>
            <a href="lessons.html" class="text-slate-900">Lessons</a>
            <a href="quiz.html" data-nav-quiz class="hover:text-slate-900">Quiz</a>
            <a href="resources.html" class="hover:text-slate-900">Resources</a>
        </nav>
        <div class="relative flex items-center gap-3" data-nav-container>
            <a data-nav-auth href="index.html#auth" class="inline-flex items-center justify-center rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white">Login</a>
            <button type="button" data-nav-user class="hidden items-center justify-center rounded-full" aria-label="Account menu">
                <img src="assets/images/account_logo.png" alt="Account" class="h-16 w-16">
            </button>
            <div data-nav-menu class="absolute right-0 top-12 hidden w-52 rounded-2xl border border-slate-200 bg-white p-4 shadow-2xl">
                <p class="text-xs font-medium text-slate-900 mb-2">Signed in as</p>
                <p data-nav-user-name class="text-sm font-semibold text-slate-900">Your account</p>
                <p data-nav-user-email class="text-xs text-slate-900 mb-3">email@example.com</p>
                <a href="dashboard.html" class="block rounded-xl bg-slate-900 px-4 py-2 text-center text-sm font-semibold text-white mb-2">Dashboard</a>
                <button type="button" data-nav-logout class="w-full rounded-xl border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-50">Log out</button>
            </div>
        </div>
    </div>
</header>

<main class="max-w-6xl mx-auto px-6 py-10 lg:py-14">
    <div class="text-right mb-10">
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-900">Progress</p>
        <p class="text-3xl font-semibold" id="hero-progress-label">0% complete</p>
    </div>

    <section class="grid gap-10 lg:grid-cols-[1.1fr_0.9fr] items-start" id="lesson-list">
        <div>
            <p class="text-sm font-semibold uppercase tracking-[0.3em] text-slate-900">Your path</p>
            <h1 class="mt-3 text-4xl font-semibold leading-tight">Work through each lesson, then unlock the final quiz.</h1>
            <p class="mt-4 text-lg text-slate-900">Each card takes only a few minutes. Listen to the narration, pick the safest option, and build your confidence before moving to the next topic.</p>
            <div class="mt-8 flex flex-wrap items-center gap-4">
                <button type="button" id="start-lessons" class="inline-flex items-center gap-2 rounded-full bg-slate-900 px-6 py-3 text-base font-semibold text-white">Start here &rarr;</button>
                <a href="lesson-intro.html" class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-6 py-3 text-base font-semibold text-slate-900 hover:bg-slate-100">How it works</a>
            </div>
            <div class="mt-8 h-2 w-full rounded-full bg-slate-100">
                <div id="hero-progress" class="h-full rounded-full bg-slate-900" style="width:0%"></div>
            </div>
            <p class="mt-2 text-sm text-slate-900"><span id="completed-count">0</span>/<span id="total-lessons">5</span> lessons completed</p>
        </div>

        <div class="grid gap-6">
            <article class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
                <p class="text-sm font-semibold text-emerald-600">Lessons</p>
                <h2 class="mt-2 text-2xl font-semibold">Guided practice cards</h2>
                <p class="mt-3 text-sm text-slate-900">Listen, choose the safest option, and earn 100% to unlock the quiz.</p>
                <p class="mt-4 text-sm font-semibold text-slate-900">Status: <span id="hero-status">Getting started</span></p>
            </article>
            <article class="rounded-3xl border border-slate-200 bg-white/80 p-6 shadow-sm" id="quiz-card">
                <div id="quiz-status" class="text-sm font-semibold text-slate-900">Locked until lessons finished</div>
                <h2 class="mt-2 text-2xl font-semibold">Final quiz</h2>
                <p class="mt-3 text-sm text-slate-900">Prove what you have learned across all five topics.</p>
                <button type="button" id="quiz-button" disabled class="mt-6 inline-flex w-full items-center justify-center gap-2 rounded-full bg-slate-200 px-5 py-2 text-sm font-semibold text-slate-900">
                    Open quiz
                </button>
                <p id="quiz-note" class="mt-3 text-xs font-semibold text-slate-900">Complete every lesson first.</p>
            </article>
            <article class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
                <p class="text-sm font-semibold text-indigo-600">Need a refresher?</p>
                <h2 class="mt-2 text-2xl font-semibold">Resources library</h2>
                <p class="mt-3 text-sm text-slate-900">Articles and videos you can return to at any time.</p>
                <a href="resources.html" class="mt-6 inline-flex items-center gap-2 text-sm font-semibold text-slate-900">Browse resources &rarr;</a>
            </article>
        </div>
    </section>

    <section class="mt-12 space-y-6" id="lessons-container"></section>

    <section id="quiz-jump-section" class="mt-12 rounded-3xl border border-slate-200 bg-white p-8 shadow-sm">
        <div class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
            <div>
                <p class="text-sm font-semibold text-slate-900">Finished the cards?</p>
                <h2 class="text-2xl font-semibold">Move on to the full quiz for a confidence check.</h2>
            </div>
            <button type="button" id="jump-to-quiz-btn" class="inline-flex items-center gap-3 rounded-full bg-slate-900 px-6 py-3 text-base font-semibold text-white">Jump to quiz &rarr;</button>
        </div>
    </section>
</main>

<div id="intro-modal" class="fixed inset-0 z-40 hidden items-center justify-center bg-slate-900/60 px-6">
    <div class="relative max-w-lg rounded-3xl bg-white p-8 shadow-2xl">
        <button type="button" id="intro-close" class="absolute right-4 top-4 text-2xl text-slate-800 hover:text-slate-900" aria-label="Close intro">&times;</button>
        <p class="text-sm font-semibold text-slate-900">First visit</p>
        <h2 class="mt-2 text-3xl font-semibold">Here is how CyberLearn works</h2>
        <ul class="mt-4 space-y-2 text-slate-900 text-sm">
            <li>â€¢ Work through each lesson in order.</li>
            <li>â€¢ Listen to the narration if you prefer audio.</li>
            <li>â€¢ Pick the safest answer to reach 100%.</li>
            <li>â€¢ Unlock the final quiz once all lessons are complete.</li>
        </ul>
        <button type="button" id="intro-start" class="mt-6 inline-flex w-full items-center justify-center rounded-full bg-slate-900 px-6 py-3 text-base font-semibold text-white">Got it, letâ€™s start</button>
    </div>
</div>

<div id="dashboard-drawer" class="fixed inset-0 z-50 hidden bg-slate-900/50 px-6 py-10">
    <div class="drawer-enter max-w-sm rounded-3xl bg-white p-8 shadow-2xl">
        <div class="flex items-center justify-between mb-6">
            <button type="button" id="drawer-close" class="text-2xl text-slate-800 hover:text-slate-900" aria-label="Close menu">&times;</button>
        </div>
        <nav class="space-y-3 text-sm font-semibold text-slate-900">
            <a href="dashboard.html" class="block rounded-2xl border border-slate-200 px-4 py-3 hover:border-slate-400">Dashboard</a>
            <a href="quiz.html" class="block rounded-2xl border border-slate-200 px-4 py-3 hover:border-slate-400">Quiz</a>
            <a href="resources.html" class="block rounded-2xl border border-slate-200 px-4 py-3 hover:border-slate-400">Resources</a>
            <a href="lesson-intro.html" class="block rounded-2xl border border-slate-200 px-4 py-3 hover:border-slate-400">Lesson overview</a>
        </nav>
        <button type="button" id="drawer-logout" class="mt-8 w-full rounded-2xl border border-slate-200 px-4 py-3 text-sm font-semibold text-slate-900 hover:bg-slate-50">Log out</button>
    </div>
</div>

<script src="assets/js/cyberlearn.js"></script>
<script src="assets/js/session-timeout.js"></script>

<script>
    if (!window.CyberLearn || !window.CyberLearn.getActiveUser()) {
        document.body.innerHTML = '<div style="position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:9999;"><div style="background:white;padding:3rem;border-radius:1.5rem;max-width:400px;text-align:center;box-shadow:0 25px 50px rgba(0,0,0,0.3);"><h2 style="font-size:1.5rem;font-weight:600;margin-bottom:1rem;color:#0f172a;">Access Denied</h2><p style="color:#475569;margin-bottom:1.5rem;">You must be logged in to access learning resources.</p><p style="font-size:0.875rem;color:#94a3b8;">Redirecting to login...</p></div></div>';
        setTimeout(() => { window.location.href = 'index.html'; }, 2000);
    }
</script>

<script>
    (() => {
        const LESSONS = [
            { id: 'lesson-1', number: 'Lesson 1', title: 'Spotting fake emails', summary: 'Learn to recognise phishing emails and react safely.', link: 'lesson-1.html' },
            { id: 'lesson-2', number: 'Lesson 2', title: 'Creating strong passwords', summary: 'Use easy-to-remember passphrases that attackers cannot guess.', link: 'lesson-2.html' },
            { id: 'lesson-3', number: 'Lesson 3', title: 'Social media safety', summary: 'Handle friend requests and urgent messages with confidence.', link: 'lesson-3.html' },
            { id: 'lesson-4', number: 'Lesson 4', title: 'Phone and text scams', summary: 'Spot vishing and smishing tricks before you respond.', link: 'lesson-4.html' },
            { id: 'lesson-5', number: 'Lesson 5', title: 'Safe online shopping', summary: 'Check websites and Wi-Fi connections before paying online.', link: 'lesson-5.html' }
        ];

        const lessonsContainer = document.getElementById('lessons-container');
        const completedCount = document.getElementById('completed-count');
        const totalLessons = document.getElementById('total-lessons');
        const heroProgress = document.getElementById('hero-progress');
        const heroProgressLabel = document.getElementById('hero-progress-label');
        const heroStatus = document.getElementById('hero-status');
        const quizButton = document.getElementById('quiz-button');
        const quizStatus = document.getElementById('quiz-status');
        const quizNote = document.getElementById('quiz-note');
        const introModal = document.getElementById('intro-modal');
        const introStart = document.getElementById('intro-start');
        const introClose = document.getElementById('intro-close');
        const hamburger = document.getElementById('lessons-header-menu');
        const drawer = document.getElementById('dashboard-drawer');
        const drawerClose = document.getElementById('drawer-close');
        const drawerLogout = document.getElementById('drawer-logout');
        const startButton = document.getElementById('start-lessons');
        const INTRO_KEY = 'cyberlearn_intro_seen';
        totalLessons.textContent = LESSONS.length;

        function openDrawer() {
            if (drawer) drawer.classList.remove('hidden');
        }

        function closeDrawer() {
            if (drawer) drawer.classList.add('hidden');
        }

        if (hamburger) {
            hamburger.addEventListener('click', openDrawer);
        }

        if (drawerClose) {
            drawerClose.addEventListener('click', closeDrawer);
        }

        if (drawer) {
            drawer.addEventListener('click', (event) => {
                if (event.target === drawer) {
                    closeDrawer();
                }
            });
        }

        if (drawerLogout) {
            drawerLogout.addEventListener('click', () => {
                if (window.CyberLearn && window.CyberLearn.logout) {
                    window.CyberLearn.logout();
                }
                closeDrawer();
                window.location.href = 'landing.html';
            });
        }

        const quizDrawerLink = document.querySelector('#dashboard-drawer a[href="quiz.html"]');
        if (quizDrawerLink) {
            quizDrawerLink.addEventListener('click', (event) => {
                const progress = window.CyberLearn.getProgress();
                const lessonsProgress = progress.lessons || {};
                const allLessonsComplete = window.CyberLearn.LESSON_IDS.every((id) => (lessonsProgress[id] || 0) >= 100);
                
                if (!allLessonsComplete) {
                    event.preventDefault();
                    alert('Please complete all lessons first before taking the quiz.');
                    closeDrawer();
                    return false;
                }
            });
        }

        function statusLabel(percent) {
            if (percent >= 100) return 'Completed';
            if (percent > 0) return 'Continue';
            return 'Not started';
        }

        function buttonLabel(percent) {
            if (percent >= 100) return 'Review lesson';
            if (percent > 0) return 'Continue';
            return 'Start lesson';
        }

        function renderLessons() {
            const progress = window.CyberLearn.getProgress();
            const lessonsProgress = progress.lessons || {};
            let completed = 0;
            lessonsContainer.innerHTML = '';

            LESSONS.forEach((lesson) => {
                const percent = Math.min(100, lessonsProgress[lesson.id] || 0);
                if (percent >= 100) completed += 1;

                const card = document.createElement('article');
                card.className = 'lesson-card flex flex-col gap-4 p-6';
                card.innerHTML = `
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-slate-900">${lesson.number}</p>
                            <h3 class="mt-1 text-2xl font-semibold">${lesson.title}</h3>
                            <p class="mt-2 text-sm text-slate-900">${lesson.summary}</p>
                        </div>
                        <div class="ml-6 text-right">
                            <div class="text-sm font-semibold text-slate-900">${statusLabel(percent)}</div>
                        </div>
                    </div>
                    <div>
                        <div class="h-2 w-full rounded-full bg-slate-100">
                            <div class="h-full rounded-full bg-slate-900" style="width:${percent}%"></div>
                        </div>
                        <p class="mt-2 text-xs text-slate-900">${percent}% complete</p>
                    </div>
                    <div class="flex justify-end">
                        <a href="${lesson.link}" class="inline-flex items-center justify-center gap-2 rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white">${buttonLabel(percent)} &rarr;</a>
                    </div>
                `;
                lessonsContainer.appendChild(card);
            });

            completedCount.textContent = completed;
            const overall = Math.round((completed / LESSONS.length) * 100);
            heroProgress.style.width = `${overall}%`;
            heroProgressLabel.textContent = `${overall}% complete`;
            heroStatus.textContent = completed === LESSONS.length ? 'All set Â· quiz unlocked' : completed === 0 ? 'Getting started' : 'Keep going';
            updateQuizCard(progress);
            updateJumpToQuizButton(progress);
        }

        function updateJumpToQuizButton(progress) {
            const lessonsProgress = progress.lessons || {};
            const unlocked = window.CyberLearn.LESSON_IDS.every((id) => (lessonsProgress[id] || 0) >= 100);
            const jumpBtn = document.getElementById('jump-to-quiz-btn');
            const jumpSection = document.getElementById('quiz-jump-section');
            
            if (unlocked) {
                jumpBtn.disabled = false;
                jumpBtn.className = 'inline-flex items-center gap-3 rounded-full bg-slate-900 px-6 py-3 text-base font-semibold text-white hover:bg-slate-700 transition cursor-pointer';
                jumpBtn.textContent = 'Jump to quiz â†’';
                jumpSection.className = 'mt-12 rounded-3xl border border-slate-200 bg-white p-8 shadow-sm';
            } else {
                jumpBtn.disabled = true;
                jumpBtn.className = 'inline-flex items-center gap-3 rounded-full bg-slate-300 px-6 py-3 text-base font-semibold text-slate-500 cursor-not-allowed';
                jumpBtn.textContent = 'Jump to quiz ðŸ”’';
                jumpSection.className = 'mt-12 rounded-3xl border border-slate-200 bg-slate-100 p-8 shadow-sm opacity-60';
            }
        }

        function updateQuizCard(progress) {
            const lessonsProgress = progress.lessons || {};
            const unlocked = window.CyberLearn.LESSON_IDS.every((id) => (lessonsProgress[id] || 0) >= 100);
            if (unlocked) {
                quizButton.disabled = false;
                quizButton.className = 'mt-6 inline-flex w-full items-center justify-center gap-2 rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white';
                quizStatus.innerHTML = '<span class="text-sm font-semibold text-emerald-600">Unlocked Â· Ready</span>';
                quizNote.classList.add('hidden');
            } else {
                quizButton.disabled = true;
                quizButton.className = 'mt-6 inline-flex w-full items-center justify-center gap-2 rounded-full bg-slate-200 px-5 py-2 text-sm font-semibold text-slate-900';
                quizStatus.textContent = 'Locked until lessons finished';
                quizNote.classList.remove('hidden');
            }
        }

        quizButton.addEventListener('click', () => {
            if (!quizButton.disabled) {
                window.location.href = 'quiz.html';
            }
        });

        const jumpToQuizBtn = document.getElementById('jump-to-quiz-btn');
        if (jumpToQuizBtn) {
            jumpToQuizBtn.addEventListener('click', () => {
                const progress = window.CyberLearn.getProgress();
                const lessonsProgress = progress.lessons || {};
                const unlocked = window.CyberLearn.LESSON_IDS.every((id) => (lessonsProgress[id] || 0) >= 100);
                
                if (unlocked) {
                    window.location.href = 'quiz.html';
                } else {
                    alert('Please complete all lessons first before taking the quiz.');
                }
            });
        }

        if (startButton) {
            startButton.addEventListener('click', () => {
                lessonsContainer.scrollIntoView({ behavior: 'smooth' });
                if (!localStorage.getItem(INTRO_KEY)) {
                    introModal.classList.remove('hidden');
                }
            });
        }

        introStart.addEventListener('click', () => {
            introModal.classList.add('hidden');
            localStorage.setItem(INTRO_KEY, 'true');
        });

        introClose.addEventListener('click', () => {
            introModal.classList.add('hidden');
            localStorage.setItem(INTRO_KEY, 'true');
        });

        if (!localStorage.getItem(INTRO_KEY)) {
            introModal.classList.remove('hidden');
        }

        renderLessons();
    })();
</script>

<footer class="max-w-6xl mx-auto px-6 py-8 mt-12 border-t border-slate-200/70">
    <div class="flex items-center justify-between text-sm text-slate-900">
        <p>&copy; 2025 CyberLearn. All rights reserved.</p>
        <div class="flex gap-4">
            <a href="encryption-demo.html" class="hover:underline font-medium">Encryption</a>
            <a href="policy.html" class="hover:underline font-medium">Policy</a>
        </div>
    </div>
</footer>

</body>
</html>
