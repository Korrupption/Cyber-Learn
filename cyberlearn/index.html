<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberLearn | Welcome</title>
    <script>
        window.location.href = 'landing.html';
    </script>
</head>
<body>
    <p>Redirecting to CyberLearn...</p>
</body>
</html>
            <a href="lessons.html" class="hover:text-slate-900">Lessons</a>
            <a href="quiz.html" class="hover:text-slate-900">Quiz</a>
            <a href="resources.html" class="hover:text-slate-900">Resources</a>
        </nav>
        <a href="#auth" class="hidden md:inline-flex items-center justify-center rounded-full border border-slate-300 px-5 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100">
            Login
        </a>
    </div>
</header>

<main class="max-w-6xl mx-auto px-6 py-12 lg:py-20">
    <section class="grid gap-12 lg:grid-cols-[1.1fr_0.9fr] items-start">
        <div>
            <p class="text-sm font-semibold uppercase tracking-[0.3em] text-slate-900">Welcome to CyberLearn</p>
            <h1 class="mt-4 text-4xl lg:text-5xl font-semibold leading-tight">Build safer online habits in minutes a day.</h1>
            <p class="mt-6 text-lg text-slate-900 max-w-2xl">Short lessons, friendly quizzes, and plain-language resources guide you through passwords, phishing, and everyday security decisions.</p>
            <div class="mt-8 flex flex-wrap items-center gap-4">
                <a href="lessons.html" class="inline-flex items-center gap-2 rounded-full bg-slate-900 px-6 py-3 text-base font-semibold text-white">Get Started &rarr;</a>
                <a href="lesson-intro.html" class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-6 py-3 text-base font-semibold text-slate-900 hover:bg-slate-100">How lessons work</a>
            </div>
            <div class="mt-12 grid gap-6 md:grid-cols-2">
                <article class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
                    <p class="text-sm font-semibold text-emerald-600">Step-by-step lessons</p>
                    <p class="mt-2 text-sm text-slate-900">Five topics with guided cards and instant feedback.</p>
                </article>
                <article class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
                    <p class="text-sm font-semibold text-indigo-600">Friendly quizzes</p>
                    <p class="mt-2 text-sm text-slate-900">Locked until lessons finish for a stress-free flow.</p>
                </article>
            </div>
        </div>

        <div id="auth" class="bg-white border border-slate-200 rounded-3xl p-8 shadow-sm">
            <div class="grid grid-cols-2 gap-2" role="tablist">
                <button type="button" data-auth-tab="login" class="auth-tab active rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white">Existing User? Login</button>
                <button type="button" data-auth-tab="register" class="auth-tab rounded-full bg-slate-100 px-4 py-2 text-sm font-semibold text-slate-900">New User? Register</button>
            </div>

            <form id="login-form" data-auth-panel="login" class="auth-panel space-y-5 pt-6">
                <div>
                    <label class="block text-sm font-medium text-slate-900 mb-2" for="login-email">Email</label>
                    <input id="login-email" type="email" class="w-full rounded-2xl border border-slate-300 px-4 py-3 text-base focus:border-slate-900 focus:outline-none" placeholder="you@example.com" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-900 mb-2" for="login-password">Password</label>
                    <input id="login-password" type="password" class="w-full rounded-2xl border border-slate-300 px-4 py-3 text-base focus:border-slate-900 focus:outline-none" placeholder="Enter password" required>
                </div>
                <p id="login-message" class="text-sm font-medium text-rose-600 hidden"></p>
                <button type="submit" class="w-full rounded-full bg-slate-900 px-4 py-3 text-base font-semibold text-white">Login to dashboard</button>
            </form>

            <form id="register-form" data-auth-panel="register" class="auth-panel hidden space-y-5 pt-6">
                <div>
                    <label class="block text-sm font-medium text-slate-900 mb-2" for="reg-name">Name</label>
                    <input id="reg-name" type="text" class="w-full rounded-2xl border border-slate-300 px-4 py-3 text-base focus:border-slate-900 focus:outline-none" placeholder="Full name" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-900 mb-2" for="reg-email">Email</label>
                    <input id="reg-email" type="email" class="w-full rounded-2xl border border-slate-300 px-4 py-3 text-base focus:border-slate-900 focus:outline-none" placeholder="you@example.com" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-900 mb-2" for="reg-password">Password</label>
                    <input id="reg-password" type="password" class="w-full rounded-2xl border border-slate-300 px-4 py-3 text-base focus:border-slate-900 focus:outline-none" placeholder="At least 8 characters" required>
                    <ul class="mt-3 text-xs text-slate-900 space-y-1">
                        <li>• 8+ characters</li>
                        <li>• Include a number</li>
                        <li>• Include a symbol</li>
                    </ul>
                </div>
                <p id="reg-message" class="text-sm font-medium text-rose-600 hidden"></p>
                <button type="submit" class="w-full rounded-full border border-slate-900 px-4 py-3 text-base font-semibold text-slate-900">Create account</button>
            </form>
        </div>
    </section>
</main>

<script>
    function goToLessonIntro() {
        window.location.href = "lessons.html";
    }

    function getAccounts() {
        const raw = localStorage.getItem('osafe_accounts');
        try {
            return raw ? JSON.parse(raw) : {};
        } catch (e) {
            console.warn("Resetting accounts due to parse error", e);
            return {};
        }
    }

    function saveAccounts(accounts) {
        localStorage.setItem('osafe_accounts', JSON.stringify(accounts));
    }

    function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    const tabs = document.querySelectorAll('[data-auth-tab]');
    const panels = document.querySelectorAll('[data-auth-panel]');

    function switchAuth(target) {
        tabs.forEach((tab) => {
            const isActive = tab.dataset.authTab === target;
            tab.classList.toggle('bg-slate-900', isActive);
            tab.classList.toggle('text-white', isActive);
            tab.classList.toggle('bg-slate-100', !isActive);
            tab.classList.toggle('text-slate-900', !isActive);
        });

        panels.forEach((panel) => {
            const isActive = panel.dataset.authPanel === target;
            panel.classList.toggle('hidden', !isActive);
        });
    }

    tabs.forEach((tab) => {
        tab.addEventListener('click', () => switchAuth(tab.dataset.authTab));
    });

    switchAuth('login');

    const registerForm = document.getElementById('register-form');
    const regName = document.getElementById('reg-name');
    const regEmail = document.getElementById('reg-email');
    const regPassword = document.getElementById('reg-password');
    const regMsg = document.getElementById('reg-message');

    registerForm.addEventListener('submit', function (e) {
        e.preventDefault();
        regMsg.classList.add('hidden');

        const name = regName.value.trim();
        const email = regEmail.value.trim();
        const pass = regPassword.value.trim();

        if (!name) {
            regMsg.textContent = "Please enter your name.";
            regMsg.classList.remove('hidden');
            return;
        }

        if (!validateEmail(email)) {
            regMsg.textContent = "Please enter a valid email address.";
            regMsg.classList.remove('hidden');
            return;
        }

        if (pass.length < 8 || !/[0-9]/.test(pass) || !/[^A-Za-z0-9]/.test(pass)) {
            regMsg.textContent = "Password must be 8+ characters with a number and symbol.";
            regMsg.classList.remove('hidden');
            return;
        }

        const accounts = getAccounts();
        if (accounts[email]) {
            regMsg.textContent = "An account with this email already exists. Please sign in.";
            regMsg.classList.remove('hidden');
            return;
        }

        const newAccount = {
            name,
            password: pass,
            createdAt: new Date().toISOString()
        };
        
        accounts[email] = window.CyberEncrypt ? 
            window.CyberEncrypt.encryptAccountData(newAccount) : 
            newAccount;
        
        saveAccounts(accounts);

        localStorage.setItem('osafe_currentUserEmail', email);
        localStorage.setItem('osafe_currentUserName', name);

        goToLessonIntro();
    });

    const loginForm = document.getElementById('login-form');
    const loginEmail = document.getElementById('login-email');
    const loginPassword = document.getElementById('login-password');
    const loginMsg = document.getElementById('login-message');

    loginForm.addEventListener('submit', function (e) {
        e.preventDefault();
        loginMsg.classList.add('hidden');

        const email = loginEmail.value.trim();
        const pass = loginPassword.value.trim();

        if (!validateEmail(email)) {
            loginMsg.textContent = "Please enter a valid email address.";
            loginMsg.classList.remove('hidden');
            return;
        }

        const accounts = getAccounts();
        const account = accounts[email];

        if (!account) {
            loginMsg.textContent = "No account found with this email. Please create an account.";
            loginMsg.classList.remove('hidden');
            return;
        }

        const actualPassword = account.encrypted && window.CyberEncrypt ? 
            window.CyberEncrypt.decrypt(account.password) : 
            account.password;

        if (actualPassword !== pass) {
            loginMsg.textContent = "Incorrect password. Please try again.";
            loginMsg.classList.remove('hidden');
            return;
        }

        const storedName = account.name || email.split('@')[0];

        if (!account.name) {
            account.name = storedName;
            saveAccounts(accounts);
        }

        localStorage.setItem('osafe_currentUserEmail', email);
        localStorage.setItem('osafe_currentUserName', storedName);

        goToLessonIntro();
    });
</script>

<footer class="max-w-6xl mx-auto px-6 py-8 mt-12 border-t border-slate-200/70">
    <div class="flex items-center justify-between text-sm text-slate-900">
        <p>&copy; 2025 CyberLearn. All rights reserved.</p>
        <div class="flex gap-4">
            <a href="encryption-demo.html" class="hover:underline font-medium">Encryption</a>
            <a href="policy.html" class="hover:underline font-medium">Policy</a>
        </div>
    </div>
</footer>

<script src="assets/js/encryption.js"></script>
</body>
</html>
